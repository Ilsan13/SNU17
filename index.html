<!DOCTYPE html>
<html>
<head>
<title>HTML5 with Hanbit</title>

<style>
a { text-decoration: none;}
</style>

<style>
body {
    margin: 0;
    padding: 0;
    background-image: url('https://github.com/Ilsan13/SNU17/blob/main/BackgroundAircap.jpg?raw=true');
    background-repeat: repeat;
    background-size: cover;
    background-attachment: fixed;
}
#Header {
display: flex;
justify-content: space-between;
height: 70px;
}
.Title {
right: 0px;
font-size:50px;
background: #173ccf;
border : 3px solid #910fd7;
margin: 10px 0px 0px 0px;
padding: 5px 10px 80px 10px;
color : #FFFFFF;
}
.Menu {
background: #FFFFFF;
margin: 10px 0px 30px 20px;
padding: 5px 10px 0px 10px;
}
#Booped {
background: #dfcdc8;
display : inline-block;
font-size: 40px;
margin: 0px 0px 30px 20px;
padding: 10px 10px 0px 10px;
width: 450px;
height: 70px;
margin: 50px 0px 0px 0px;
}
#explain {
background: #dfcdc8;
display : inline-block;
font-size: 20px;
margin: 0px 0px 30px 20px;
padding: 0px 5px 0px 10px;
width: 200px;
height: 70px;
margin: 50px 10px 0px 0px;
}
.fever {
    position: absolute;
	float : right;
    left: 800px;
    font-size: 70px;
    color: red;
    font-weight: bold;
    display: none;
    animation: flash 0.2s infinite;
}
@keyframes flash {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
}
#se{
}
.BigBackGround {
display: flex;
justify-content: left;
flex-flow: wrap;
line-height: 0px;
margin: 50px 0px 0px 0px;
}
.img{
 -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -o-user-select: none;
  user-select: none;
  -webkit-user-drag: none;
  -khtml-user-drag: none;
  -moz-user-drag: none;
  -o-user-drag: none;
  user-drag: none;
}
#rainbow{
	background-image: linear-gradient(to right, hsl( 100, 100%, 35%), hsl( 90, 100%, 40%), 
	hsl( 80, 100%, 50%), hsl( 70, 100%, 60%), hsl( 50, 100%, 70%), hsl( 10, 100%, 50%),  hsl( 10, 100%, 70%));    
	width: 652px;    
	height: 30px;
	margin: 20px 0px 0px 0px;
.FeverBox{
	height: 28px; width: 26px; float: left;
	border: 2px outset #d2d0d1;
	margin: 0px;
}

}
.reset {
    position: absolute;
    top: 70px;
    right: 200px;
    padding: 10px 20px;
    font-size: 20px;
    background-color: #C948BA;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.reset:hover {
    background-color: #a0379e;
}
.modal {
  display: none;
  position: fixed;
  z-index: 1;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgb(0, 0, 0);
  background-color: rgba(0, 0, 0, 0.4);
}

/* Modal Content */
.modal-content {
  background-color: #fefefe;
  margin: 15% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 50%;
  background-color: #E0F7FA; /* Light blue background similar to the image */
}

/* The Close Button */
.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

.modal-header {
  padding: 2px 16px;
  background-color: #E1BEE7;
  color: black;
}

.modal-body {
  padding: 2px 16px;
}

.modal-footer {
  padding: 2px 16px;
  background-color: #E1BEE7;
  color: black;
  text-align: right;
}

.collection-item {
  width: 120px;
  height: 150px;
  background-color: #E3F2FD;
  border: 1px solid #90CAF9;
  display: inline-block;
  margin: 10px;
  text-align: center;
  line-height: 150px;
  font-size: 20px;
  font-weight: bold;
}


</style>

<script>
        window.onload = function() {
            var bnum = 300;
            let container = document.querySelector(".BigBackGround");
            const div1_el = '<div class="paper"><a><img class="img" width="50px" src="https://github.com/Ilsan13/SNU17/blob/main/nonpopped.png?raw=true"></a></div>';
            let content = '';
            for (let i = 0; i < bnum; i++) {
                content += div1_el;
            }
            container.innerHTML += content;

            let popcount = 0;
			let Score = 0;
			let FeverTime = 0;
			let startTime, endTime;
			let usedIndexes = [];
            document.getElementById("Booped").innerText = "Popped Air cap : " + Score;

            let img_el = document.querySelectorAll("img");
            const feverBoxes = document.querySelectorAll(".FeverBox");
            let maxPops = feverBoxes.length;

            // 마지막 FeverBox의 width를 3배로 설정
            if (maxPops > 0) {
                feverBoxes[maxPops - 1].style.width = "78px";  // 26px * 3 = 78px
            }

            let reverting = false;
            let revertInterval;
			
			const messageElement = document.createElement("div");
			messageElement.setAttribute("id", "randomMessage");
			messageElement.style.position = "absolute";
			messageElement.style.top = "130px";
			messageElement.style.left = "70%";
			messageElement.style.transform = "translateX(-50%)";
			messageElement.style.fontSize = "30px";
			messageElement.style.padding = "5px";
			messageElement.style.border = "3px solid #154288" ;
			messageElement.style.fontWeight = "bold";
			messageElement.style.color = "green";
			//messageElement.style.display = "none";
			document.body.appendChild(messageElement);

			function showRandomMessage(index) {
				messageElement.innerText = `You Found ${index}!`;
				messageElement.style.display = "block";
				setTimeout(() => {
					messageElement.style.display = "none";
				}, 3000); // Message appears for 3 seconds
			}
			
			function getRandomIndex() {
				let availableIndexes = [];
				for (let i = 1; i <= 40; i++) {
					if (!usedIndexes.includes(i)) {
						availableIndexes.push(i);
					}
				}
				if (availableIndexes.length > 0) {
            const randomIndex = availableIndexes[Math.floor(Math.random() * availableIndexes.length)];
            usedIndexes.push(randomIndex);
            return randomIndex;
				}
				return null; 
			}
			
			function resetFeverBoxes() {
                for (let i = 0; i < feverBoxes.length; i++) {
                    feverBoxes[i].style.backgroundImage = "none"; // 기본 상태로 되돌리기
                    feverBoxes[i].style.backgroundSize = "auto";
                }
                reverting = false; // 상태 복원 완료
            }

            function startReverting() {
                let index = maxPops - 1; // 마지막 FeverBox부터 시작
                revertInterval = setInterval(() => {
                    if (index >= 0) {
                        feverBoxes[index].style.backgroundImage = "none"; // 기본 상태로 되돌리기
                        feverBoxes[index].style.backgroundSize = "auto";
						popcount--;
                        index--;
                    } else {
                        clearInterval(revertInterval);
                        // 상태가 복원된 후 클릭 시 다시 이미지 추가를 위한 초기화
                        resetFeverBoxes();
						FeverTime = 0;
						document.getElementById("feverText").style.display = "none";
                    }
                }, 50); // 50ms마다 상태 복원
            }			
						
			function displayCollection() {
				collectionBody.innerHTML = '';
				usedIndexes.forEach(index => {
					const div = document.createElement('div');
					div.className = 'collection-item';
					div.innerText = `Index ${index}`;
					collectionBody.appendChild(div);
				});
			}
			
			function resetGame() {
				popcount = 0;
				Score = 0;
				FeverTime = 0;
				startTime = null;
				document.getElementById("Booped").innerText = "Popped Air cap : " + Score;
				document.getElementById("feverText").style.display = "none";
				resetButton.style.display = "none";
				img_el.forEach(img => {
					img.src = "https://github.com/Ilsan13/SNU17/blob/main/nonpopped.png?raw=true";
				});
				resetFeverBoxes();
			}
			
		function addEventListeners() {
			for (let i = 0; i < img_el.length; i++) {				
				img_el[i].addEventListener('click', function() {
					if (FeverTime !== 0) {
						return;
					}
					if (img_el[i].src.includes("nonpopped.png")) {
						img_el[i].src = "https://github.com/Ilsan13/SNU17/blob/main/popped.png?raw=true";
						popcount += 1;
						Score += 1;
						document.getElementById("Booped").innerText = "Popped Air cap : " + Score;

						if (Score === 1 && !startTime) {
						startTime = new Date();
						}

						// 0.1% chance to display a random message
						if (Math.random() <= 0.01) {
							const randomIndex = getRandomIndex();
							if (randomIndex !== null) {
							showRandomMessage(randomIndex);
							}
						}

						// popcount에 따라 FeverBox의 배경 이미지 업데이트
						if (popcount <= maxPops) {
							feverBoxes[popcount - 1].style.backgroundImage = "url('https://github.com/Ilsan13/SNU17/blob/main/Feverflame.png?raw=true')";
							feverBoxes[popcount - 1].style.backgroundSize = "cover";
						}

						// 모든 FeverBox가 업데이트되면 상태를 되돌리기 시작
						if (popcount === maxPops && !reverting) {
							reverting = true;
							startReverting();
							FeverTime = 1;
							document.getElementById("feverText").style.display = "block";
						}
						
						if (Score === 300) {
						endTime = new Date();
						const elapsedTime = ((endTime - startTime) / 1000).toFixed(2); 
						resetButton.style.display = "block";
						document.getElementById("elapsedTime").innerText = `Time Taken: ${elapsedTime} seconds`;
						}
					}
				});
				img_el[i].addEventListener('mouseleave', function() {
					if (FeverTime == 1 && img_el[i].src.includes("nonpopped.png")) {
						img_el[i].src = "https://github.com/Ilsan13/SNU17/blob/main/popped.png?raw=true";
						Score += 1;
						document.getElementById("Booped").innerText = "Popped Air cap : " + Score;
						if (Math.random() <= 0.01) {
								const randomIndex = getRandomIndex();
								if (randomIndex !== null) {
								showRandomMessage(randomIndex);
								}
						}
					}
				});
			}
		}
		resetButton.addEventListener('click', resetGame);
		addEventListeners();
	
		const modal = document.getElementById("collectionModal");
		const collectionBody = document.getElementById("collectionBody");
		const btn = document.querySelector(".Menu a");
		const span = document.getElementsByClassName("close")[0];
		const closeButton = document.querySelector('.closeButton');

		btn.onclick = function () {
			modal.style.display = "block";
			displayCollection();
		}

		span.onclick = function () {
			modal.style.display = "none";
		}

		closeButton.onclick = function () {
			modal.style.display = "none";
		}

		window.onclick = function (event) {
			if (event.target == modal) {
				modal.style.display = "none";
			}
		}
	
    }
    </script>
</head>
<body>

<header id="Header">
<div class="Title">
Boop Boop Air Cap
</div>
<div class="Menu">
<a href="#">Collection</a>
</div>
</header>
<section id="se">
<div id= "Booped">Popped Air cap :</div>
<div id= "explain">1. Click to Boop<br>2.Drag at Fever Time!
</div>
<div id="feverText" class="fever">F E V E R!</div>
<button id="resetButton" class="reset" style="display: none;">Reset</button>
<div id="elapsedTime" style="position: absolute; top: 170px; right: 50px; font-size: 20px; font-weight: bold;"></div>
<div id="rainbow">
<hr class="FeverBox"> 
<hr class="FeverBox"> 
<hr class="FeverBox"> 
<hr class="FeverBox"> 
<hr class="FeverBox">
<hr class="FeverBox"> 
<hr class="FeverBox"> 
<hr class="FeverBox"> 
<hr class="FeverBox"> 
<hr class="FeverBox"> 
<hr class="FeverBox"> 
<hr class="FeverBox"> 
<hr class="FeverBox"> 
<hr class="FeverBox"> 
<hr class="FeverBox"> 
<hr class="FeverBox"> 
<hr class="FeverBox"> 
<hr class="FeverBox"> 
<hr class="FeverBox"> 
<hr class="FeverBox"> 

</div>
<div class= "BigBackGround">
</div>
</section>

<div id="collectionModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <span class="close">&times;</span>
      <h2>Collection</h2>
    </div>
    <div class="modal-body" id="collectionBody">
      <!-- Dynamic Content Goes Here -->
    </div>
  </div>
</div>

</body>
</html>
